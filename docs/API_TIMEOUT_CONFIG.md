# API 超时和重试配置

## ✅ 已更新的配置

### 超时时间
- **之前**: 15 秒
- **现在**: 120 秒（2 分钟）

### 重试策略
- **重试次数**: 3 次
- **重试间隔**: 10 秒（固定）
- **总最大等待时间**: 120s + 10s + 10s = 140 秒

## 📝 修改内容

### 1. `.env` 文件
```env
APIORE_TIMEOUT_MS=120000  # 从 15000 改为 120000
```

### 2. `src/lib/apicore-client.ts`
```typescript
// 重试间隔改为固定 10 秒
const delay = 10000; // Fixed 10s interval between retries

// 默认超时改为 120 秒
const timeoutMs = parseInt(process.env.APIORE_TIMEOUT_MS || '120000', 10);
```

## 🔄 重试流程

```
第 1 次尝试 (0s)
  ↓ 失败
等待 10s
  ↓
第 2 次尝试 (10s)
  ↓ 失败
等待 10s
  ↓
第 3 次尝试 (20s)
  ↓ 失败
抛出错误
```

每次尝试最多等待 120 秒。

## 📊 时间预估

| 场景 | 时间 |
|------|------|
| 第 1 次成功 | ~6-10 秒 |
| 第 2 次成功（1 次失败后） | ~16-20 秒 |
| 第 3 次成功（2 次失败后） | ~26-30 秒 |
| 全部失败 | ~140 秒 |

## 🚀 现在可以重新测试

```bash
npm run dev
```

API 调用现在会有更长的超时时间和更多的重试机会。

## 🔧 如果还是超时

如果仍然超时，可以进一步调整：

```env
# 增加到 180 秒（3 分钟）
APIORE_TIMEOUT_MS=180000

# 增加重试次数
APIORE_MAX_RETRIES=5

# 增加重试间隔
# 需要修改代码中的 delay = 10000 为更大的值
```

## 📌 注意

- 超时时间过长会导致任务处理变慢
- 重试间隔过短可能导致 API 限流
- 建议监控 API 响应时间，根据实际情况调整
