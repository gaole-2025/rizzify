# Rizzify · PRD v1


---

## 0. 背景 / 问题陈述

* 用户仅需**上传 1 张照片**（无需选择风格），数分钟后自动生成一批“杂志级”成片，可下载。
* 首页引导用户进入 **/start** → 选择男/女生 → 按要求上传照片 → 生成。
* 生成前在 **/gen-image** 选择套餐：

  * **Free**：每日 2 张、带水印、24 小时保留。
  * **Start**：\$9.99，20 张，**10+ 风格**。
  * **Pro**：\$19.99，50 张，**20+ 风格**。
* 选择 Free 直接生成；选择 Start/Pro 跳转支付 → 支付成功后开始生成。
* 生成中展示等待动画与预计时长；完成后提示“已生成”，点击“获取照片”进入结果页（含原始上传与生成结果），支持预览与下载。
* 管理端（/admin）：查看用户注册量、套餐与支付、生成成功/失败与失败次数、退款请求与投诉建议等。

---

## 1. 目标 & 非目标

**目标**

* 任何新用户可在**单次会话**内完成：开始 → 上传 → 套餐 → 支付（可选）→ 生成 → 获取照片。
* 支持账户体系与套餐/用量约束（含免费日配额）。
* 生成进度**可见**、**可预期**、**可恢复**（刷新后仍可找回任务）。

**非目标（当前不包含）**

* 高阶编辑（局部修饰、口红/祛痘等）。
* 视频生成。
* SEO 长文与公开展示社区。

---

## 2. 主用户流（端到端）

1. Home → 点击 **Start**
2. 跳转 **/start**：选择 **性别：男 / 女**
3. 根据提示上传 **1 张照片**（jpg/png），显示通过/不通过建议（清晰度/遮挡/人脸数≥1）
4. 上传成功 → 提示“照片上传成功，专属 AI 模型准备中…”
5. 跳转 **/gen-image**：选择套餐（Free/Start/Pro）

   * Free → 直接开始生成
   * Start/Pro → 跳支付页（第三方支付）→ 支付成功回跳 **/gen-image** 自动开始
6. **生成中**：展示等待动画和预计时长；可取消/返回；网络中断刷新后仍能恢复状态
7. 生成完成 → Toast“已生成完毕” → 点击“获取照片”
8. 跳转 **结果页**：展示**原图 + 生成图**（可预览/下载/复制链接）

---

## 3. 功能需求（编号 R-###）

### R-001 首页与入口

* 首页展示产品卖点与案例缩略图；显著 **Start** CTA → /start。
* 验收（G/W/T）：

  * G：访问首页；W：点击 Start；T：进入 /start。

### R-002 /start 性别选择

* 选项：男 / 女（单选）。记录到会话。
* 验收：

  * G：进入 /start；W：选择男/女；T：选中态高亮并可继续上传。

### R-003 上传 1 张照片（必选）

* 接受 jpg/png；**大小上限 20MB**；**最小分辨率 ≥ 768px**；建议质检：清晰度、人脸、多人检测。
* 验收：

  * G：未选择文件；W：点击上传；T：出现文件选择并显示占位预览。
  * G：选择不合规文件（类型/大小/分辨率不足/无脸/多人）；W：上传；T：红色错误提示，不进入下一步。
  * G：选择合规文件；W：上传成功；T：显示“上传成功，专属 AI 模型准备中…”。

### R-004 /gen-image 套餐选择

* 选项：Free / Start(\$9.99, 20 张, 10+风格) / Pro(\$19.99, 50 张, 20+风格)。
* Free：直接进入生成；Start/Pro：跳转支付页面。
* 验收：

  * G：在 /gen-image；W：选 Free；T：直接开始生成并进入“生成中”。
  * G：在 /gen-image；W：选 Start/Pro；T：跳支付页；支付成功后回跳并自动开始生成。

### R-005 生成中（队列与进度）

* 状态：queued / running / done / error；展示预计剩余时长（如 10–15 分钟）。
* 支持刷新恢复（基于 taskId 轮询或推送）。
* 验收：

  * G：任务已创建；W：每 3s 刷新；T：展示状态与进度变化，异常时显示重试。
  * G：网络中断；W：刷新；T：可找回任务状态并继续轮询。

### R-006 结果页（原图 + 生成图）

* 列表：上传原图 1 张 + 生成的若干张（按套餐张数）。
* 支持大图预览、单张下载、复制链接；**Free 带贯穿水印且 24 小时后过期**。
* 验收：

  * G：任务完成；W：点击“获取照片”；T：进入结果页看到全部图片。
  * G：点击下载；W：下载；T：文件命名包含（plan, timestamp）。

### R-007 账户与配额

* 登录（Google OAuth）；记录套餐与剩余额度；Free 每日 2 张（每日重置）。
* 验收：

  * G：未登录；W：需要开始生成；T：弹出登录并完成后回到当前流程。
  * G：无剩余额度；W：选 Free；T：引导到套餐升级。

### R-008 支付集成

* 第三方支付（creem/等）；成功/失败回调；幂等处理；**币种 USD，税费不另计**。
* 验收：

  * G：选择 Start/Pro；W：完成支付；T：回跳后自动开始生成；失败则提示并可重试。

### R-009 管理后台（/admin）

* **角色**：单一 **Admin** 角色即可。
* 概览：总用户数、套餐分布、当日生成数、失败率、退款/投诉统计。
* 用户维度：用户信息、套餐、支付记录、任务列表（状态、失败次数）。
* 工单：退款请求与投诉建议列表（状态流转：待处理/已处理）。
* **审计日志**：记录管理员手动更改（如退款通过/拒绝、状态修改）的操作者、时间、动作与备注。
* 验收：

  * G：管理员登录；W：访问 /admin；T：能看到上述数据表与筛选；在详情页操作后审计日志新增一条记录。

### R-010 异常与容错

* 统一错误提示（toast）与重试；生成失败可一键重试（限次数/套餐约束）。
* 验收：

  * G：后端 5xx；W：发起请求；T：出现“重试”按钮且可恢复。

### R-011 用户反馈（提交 & 管理）

* 前台：提供反馈入口（悬浮按钮或页脚链接），支持类型（问题/建议/举报/退款申请），可填写文本与可选截图；提交成功提示；**也可通过联系邮箱发起**（后台统一录入）。
* 后台：/admin/feedback 查看反馈列表、筛选（类型/状态/时间/用户）、查看详情（含截图）、状态流转（新建/处理中/已解决/已拒绝），可添加内部备注。
* 验收：

  * G：用户在任意页面；W：打开反馈入口并提交；T：提示成功并生成反馈编号。
  * G：管理员；W：访问 /admin/feedback；T：能按类型/状态筛选并查看详情与备注，更新状态后可追踪。

---

## 4. 模块化验收（递进测试套件）

> 每个模块可独立测试，建议按顺序执行；通过前一个模块后再进入下一个。

**模块 A · 入口与上传**

* 覆盖：R-001/R-002/R-003
* 测试脚本（G/W/T）：

  * G：新用户；W：Home→Start→男/女→上传合规文件；T：看到“上传成功，模型准备中…”。

**模块 B · 套餐与支付**

* 覆盖：R-004/R-008/R-007（配额）
* 测试脚本：

  * Free 分支：G：有每日剩余；W：选 Free；T：直接进入生成中。
  * Start/Pro 分支：G：跳支付；W：成功回跳；T：自动开始生成且配额/订单记录更新。

**模块 C · 生成与进度**

* 覆盖：R-005
* 测试脚本：

  * G：任务创建；W：观察 1–3 分钟；T：状态从 queued→running→done，断网刷新仍可恢复。

**模块 D · 结果获取与下载**

* 覆盖：R-006
* 测试脚本：

  * G：任务完成；W：进入结果页；T：展示原图+生成图，下载文件命名正确；Free 链接 24h 失效（模拟）。

**模块 E · 管理后台**

* 覆盖：R-009/R-010
* 测试脚本：

  * G：管理员；W：查看仪表与列表；T：可按用户/状态筛选并看到失败次数与退款单。

**模块 F · 用户反馈闭环**

* 覆盖：R-011
* 测试脚本：

  * G：任意用户；W：打开反馈入口提交“问题/建议/举报/退款申请”含可选截图；T：成功并返回编号。
  * G：管理员；W：在 /admin/feedback 将该条设为“处理中→已解决/已拒绝”，添加备注；T：状态变化可追踪，支持筛选与导出。

---

## 5. 非功能性（NFR）

* NFR-1：首屏白屏 < 2.5s（桌面 4G）。
* NFR-2：生成流程全程可恢复（刷新后可找回）。
* NFR-3：错误可见并可重试；关键路径提供 loading skeleton。
* NFR-4：**额度刷新时区**：统一以 **UTC 凌晨 02:00** 进行免费额度重置。
* NFR-5：**预计时长展示**：统一以区间形式显示，例如 **10–15 分钟**。

## 6. URL 与导航

* `/` 首页（Start CTA）
* `/start` 选择性别 + 上传 1 张照片
* `/gen-image` 套餐选择 +（支付）+ 生成中
* `/results/:taskId` 结果页（原图+生成图）
* `/feedback` 用户反馈入口（也可悬浮按钮形式，不破此路由）
* `/admin` 管理后台（鉴权）
* `/admin/feedback` 反馈列表与详情页

URL 与导航

* `/` 首页（Start CTA）
* `/start` 选择性别 + 上传 1 张照片
* `/gen-image` 套餐选择 +（支付）+ 生成中
* `/results/:taskId` 结果页（原图+生成图）
* `/feedback` 用户反馈入口（也可悬浮按钮形式，不破此路由）
* `/admin` 管理后台（鉴权）
* `/admin/feedback` 反馈列表与详情页

---

## 7. 显示字段对齐（供阶段1/2使用）

* ResultCard: `{ id: uuid, url: string, plan: 'free'|'start'|'pro', createdAt: iso8601 }`
* UploadHint: `{ passed: boolean, reasons?: string[] }`
* QueueItem: `{ id: string, status: 'queued'|'running'|'done'|'error', etaSeconds?: number, progress?: number }`
* Plan: `{ code: 'free'|'start'|'pro', price: number, quota: number, styles: number }`
* AdminUserRow: `{ id: uuid, email: string, plan: string, orders: number, tasks: number, failedTasks: number }`
* FeedbackItem: `{ id: uuid, userId?: uuid, type: 'issue'|'suggestion'|'report'|'refund', message: string, imageUrls?: string[], status: 'new'|'in_progress'|'resolved'|'rejected', createdAt: iso8601, updatedAt: iso8601 }`

---

## 8. 数据与保留策略（简）

* **保留周期**：Free 生成图 24h；Start/Pro 生成图 **30 天**；到期后自动清理（可选归档后续再议）。
* **删除**：用户可在结果页手动删除单张，需**立即撤下公开访问**（直链立刻失效）。
* **水印**：Free 结果图采用**贯穿式水印**（防裁切），不可去除。

## 9. 依赖与边界

* 支付：Stripe/等；需回调与幂等校验；**货币：USD，税费不另计**。
* 存储：对象存储 + 预签名下载。
* 生成：可先接占位服务，后接真实模型。

## 10. 变更规则

* 改动任何字段或流程，需同步更新本 PRD 对应 R-### 与模块化验收脚本。

## 11. 观测与事件（最小集）

* 关键事件（开发态可在控制台观测）：

  * `upload_started`, `task_created`, `task_completed`, `download_clicked`, `feedback_submitted`, `payment_succeeded`, `payment_failed`。

## 12. 合规与内容限制（一句话版）

* 禁止上传：**裸露、他人照片、儿童等**违规内容；一经识别**直接拒绝并提示**。

## 13. 联系与法务

* 页脚必须包含：**Privacy / Terms / Contact / Feedback** 链接。
  依赖与边界
* 支付：Stripe/等；需回调与幂等校验。
* 存储：对象存储 + 预签名下载。
* 生成：可先接占位服务，后接真实模型。

---

## 10. 变更规则

* 改动任何字段或流程，需同步更新本 PRD 对应 R-### 与模块化验收脚本。
